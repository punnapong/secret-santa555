<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Secret Santa ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
<style>
body { font-family: sans-serif; text-align: center; margin-top:50px; }
input, button { font-size:22px; padding:10px; margin:8px; }
#result { font-size:26px; margin-top:20px; }
</style>
</head>
<body>

<h2>‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2>
<input id="code" placeholder="‡πÄ‡∏ä‡πà‡∏ô BRT7K2"><br>
<button onclick="draw()">‡∏î‡∏π‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡πâ</button>
<p id="result"></p>

<script>
// ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
const users = {
  "BRT7K2": { name:"‡πÑ‡∏ö‡∏£‡πå‡∏ó", used:false, target:"" },
  "TRD9Q4": { name:"‡πÄ‡∏ï‡∏¥‡∏£‡πå‡∏î", used:false, target:"" },
  "BRD5X8": { name:"‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏î", used:false, target:"" },
  "MAY3L6": { name:"‡πÄ‡∏°‡∏¢‡πå", used:false, target:"" }
};

// ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å localStorage ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏•‡∏∑‡∏°
let data = JSON.parse(localStorage.getItem("santa_data")) || users;

// ‡∏™‡∏∏‡πà‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà Secret Santa (‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á)
function assignTargets() {
  const names = Object.values(users).map(u => u.name);
  const targets = shuffle([...names]); // ‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö
  const keys = Object.keys(users);
  
  keys.forEach((key, i) => {
    if (!data[key].target) { // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡∏±‡∏ö
      // ‡∏´‡∏≤‡∏Ñ‡∏ô‡∏™‡∏∏‡πà‡∏°‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
      let target = targets[i];
      if (target === data[key].name) {
        // ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏≠‡∏∑‡πà‡∏ô
        const swapIndex = (i + 1) % targets.length;
        [targets[i], targets[swapIndex]] = [targets[swapIndex], targets[i]];
        target = targets[i];
      }
      data[key].target = target;
    }
  });
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏∏‡πà‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö
function shuffle(array) {
  for(let i=array.length-1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏π‡∏ú‡∏•
function draw() {
  const code = document.getElementById("code").value.trim();
  const output = document.getElementById("result");
  
  if (!data[code]) {
    output.innerText = "‚ùå ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
    return;
  }

  // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏¢‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà ‚Üí ‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
  if (!data[code].used) {
    assignTargets();
    data[code].used = true;
    localStorage.setItem("santa_data", JSON.stringify(data));
  }

  output.innerText = "üéÅ " + data[code].name + " ‡∏ï‡πâ‡∏≠‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡πÉ‡∏´‡πâ: " + data[code].target;
}
</script>

</body>
</html>
